const translations = {
    ar: {
        hero_badge: "ูุธุงู ุฑุณูู ูุนุชูุฏ",
        hero_title: "ูุธุงู ุงูุญุถูุฑ ูุงูุบูุงุจ ุงูุฐูู<br><span class='text-highlight'>ููุชุนููู ุงูุทุจู</span>",
        hero_subtitle: "ุญู ุชููู ูุชูุงูู ูุขูู ูุนูู ุจุฏูู ุฅูุชุฑูุช<br>ูุตูู ุฎุตูุตุงู ูุฎุฏูุฉ ูููุงุช ุงูุทุจ ููุฑุงูุฒ ุงูุชุฏุฑูุจ",
        download_on: "ุชุญููู ูุฃุฌูุฒุฉ",
        nav_lecturer: "ูููุญุงุถุฑูู",

        // How It Works
        how_it_works_title: "ููู ูุนูู ุงููุธุงู",
        step_open: "ูุชุญ ุงูุชุทุจูู",
        step_connect: "ุชูุงูุณ ุฃู ุงุฎุชูุงุฑ",
        step_done: "ุชู ุงูุชุณุฌูู",

        // Features
        feat_secure_title: "ุขูู ูููุซูู",
        feat_secure_desc: "ูุนุชูุฏ ุนูู ุชูููุงุช ูุดูุฑุฉ ูุถูุงู ุฏูุฉ ุงูุจูุงูุงุช",
        feat_offline_title: "ูุนูู ุจุฏูู ุฅูุชุฑูุช",
        feat_offline_desc: "ูุง ูุดุชุฑุท ุงุชุตุงู ุงูุทุงูุจ ุจุงูุฅูุชุฑูุช ูุชุณุฌูู ุงูุญุถูุฑ",
        feat_tech_title: "ุชูููุงุช ุญุฏูุซุฉ",
        feat_tech_desc: "ุฏุนู ูุงูู ูุชูููุงุช NFC ู Bluetooth",
        feat_dashboard_title: "ููุญุฉ ุชุญูู ูุชูุฏูุฉ",
        feat_dashboard_desc: "ุชูุงุฑูุฑ ูุญุธูุฉ ูุฅุญุตุงุฆูุงุช ุดุงููุฉ ูููุคุณุณุงุช",

        // Institutions
        inst_badge: "ูููุคุณุณุงุช",
        inst_title: "ุฅุฏุงุฑุฉ ูุฑูุฒูุฉ ููุคุณุณุชู",
        inst_desc: "ููุญุฉ ุชุญูู ูุชูุฏูุฉ ุชูููู ูู ูุชุงุจุนุฉ ูุณุจ ุงูุญุถูุฑ ูุญุธูุงู ูุชุตุฏูุฑ ุชูุงุฑูุฑ ุชูุตูููุฉ ููู ููุฑุณ ููุฌููุนุฉ ููุญุงุถุฑ ููุชุนูู",
        inst_feat1: "ูุชุงุจุนุฉ ูุญุธูุฉ ููุญุถูุฑ",
        inst_feat2: "ุชูุงุฑูุฑ ุชูุตูููุฉ ูุงุจูุฉ ููุชุตุฏูุฑ",
        inst_feat3: "ุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงููุญุงุถุฑูู",
        inst_cta: "ุชูุงุตู ูุนูุง",

        footer_copy: "Med Attendance 2026 ุฌููุน ุงูุญููู ูุญููุธุฉ",
        coming_soon_ios: "ูุฑูุจุงู ูู App Store",
        coming_soon_android: "ูุฑูุจุงู ูู Google Play",
        support_btn: "ุงูุฏุนู ุงูููู",
        privacy_policy: "ุณูุงุณุฉ ุงูุฎุตูุตูุฉ",
        terms_conditions: "ุงูุดุฑูุท ูุงูุฃุญูุงู",

        // Modal
        modal_title: "ุทุฑููุฉ ุงูุชุญููู ุนูู iPhone",
        step1_title: "ุฎุทูุฉ 1: ุชุญููู TestFlight",
        step1_desc: "ูุฌุจ ุชุญููู ุชุทุจูู TestFlight ุฃููุงู ูู ูุชุฌุฑ ุฃุจู ูุชุชููู ูู ุชุซุจูุช ุงููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ",
        btn_download_testflight: "ุชุญููู TestFlight",
        step2_title: "ุฎุทูุฉ 2: ุชุญููู BardiMad",
        step2_desc: "ุงูุขู ููููู ุงูุงูุถูุงู ูููุณุฎุฉ ุงูุชุฌุฑูุจูุฉ ูุชุญููู ุชุทุจูู ุงูุทุงูุจ",
        btn_download_app: "ุชุญููู ุงูุชุทุจูู (ุทูุงุจ)",
        btn_next: "ุงูุชุงูู",
        lang_btn_text: "English",
        download_started: "ุชู ุจุฏุก ุงูุชูุฒูู! ุชููุฏ ูุฌูุฏ ุงูุชูุฒููุงุช ๐ฅ",

        // Navigation & General
        nav_home: "ุงูุฑุฆูุณูุฉ",
        nav_kader: "Kader Attendance",
        terms_title: "ุงูุดุฑูุท ูุงูุฃุญูุงู",
        privacy_title: "ุณูุงุณุฉ ุงูุฎุตูุตูุฉ",
        page_under_construction: "ูุฐู ุงูุตูุญุฉ ููุฏ ุงูุฅูุดุงุก ุญุงููุงู",
        back_home: "ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ",
        back_kader: "ุงูุนูุฏุฉ ูู Kader Attendance",

        // Kader Attendance Page
        kader_badge: "ูุธุงู ุฑุณูู ูุนุชูุฏ",
        kader_hero_title: "Kader Attendance",
        kader_hero_desc: "ูุธุงู ุฅููุชุฑููู ูุชูุงูู ูุฅุฏุงุฑุฉ ุงูุญุถูุฑ ูุงูุบูุงุจ ูุฎุตุต ููุทุงุน ุงูุชุนููู ุงูุทุจู. ูุถูู ูู ุชุณุฌูู ุงูุญุถูุฑ ุจุทุฑููุฉ ุขููุฉ ูุณุฑูุนุฉ ุจุงุณุชุฎุฏุงู ุงูููุงุชู ุงููุญูููุฉ ููุท.",
        kader_serving_title: "ูุฎุฏู ูุฐุง ุงููุธุงู",
        kader_target_1: "ูููุงุช ุงูุทุจ ูุงูุนููู ุงูุตุญูุฉ",
        kader_target_2: "ูุฑุงูุฒ ุงูุชุฏุฑูุจ ุงูุทุจู",
        kader_target_3: "ุงููุคุชูุฑุงุช ููุฑุด ุงูุนูู",
        kader_target_4: "ูุคุณุณุงุช ุงูุชุนููู ุงูุทุจู ุงููุณุชูุฑ",
        mech_title: "ุขููุฉ ุงูุนูู",
        mech_subtitle: "ุชูุงุตู ูุจุงุดุฑ ุจูู ููุจุงูู ุงููุชุนูู ูููุจุงูู ุงููุญุงุถุฑุ ููุง ูุดุชุฑุท ุชูุงุฌุฏ ุงูุทุฑููู ุนูู ุงูุดุจูุฉ.",
        mech_nfc_title: "ุชูููุฉ NFC",
        mech_nfc_desc: "ููุงูุณุฉ ุงูููุจุงูููู ูุจุนุถููุง ูุชุณุฌูู ุงูุญุถูุฑ ููุฑุงู ุจุดูู ุขูู.",
        mech_bt_title: "ุชูููุฉ Bluetooth",
        mech_bt_desc: "ูุธูุฑ ุงููุชุนูููู ุงููุฑูุจูู ูุฏู ุงููุญุงุถุฑ ููุฎุชุงุฑ ูููู ููุณุฌู ุญุถูุฑูู.",
        mech_manual_title: "ุงูุฅุถุงูุฉ ุงููุฏููุฉ",
        mech_manual_desc: "ูููู ูููุญุงุถุฑ ุฅุถุงูุฉ ุงููุชุนูู ูุฏููุงู ูู ุญุงู ุนุฏู ุชููุฑ ุงูุทุฑู ุงูุฃุฎุฑู.",
        management_badge: "ุงูุฅุฏุงุฑุฉ ูุงูุชุญูู",
        lecturer_dash_title: "ูุธุงู ุงูุญุณุงุจุงุช ูุงูุตูุงุญูุงุช",
        lecturer_title: "ุญุณุงุจ ุงููุญุงุถุฑ",
        lecturer_feat1: "ุชูุนูู ุจุนุฏ ููุงููุฉ ุงูุฅุฏุงุฑุฉ",
        lecturer_feat2: "ุฑุคูุฉ ุงูุณูุดูุงุช ูุงููุฑู",
        lecturer_feat3: "ุชุณุฌูู ุงูุญุถูุฑ (NFC, BT, ูุฏูู)",
        dash_title: "ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ",
        dash_feat1: "ูุชุงุจุนุฉ ูุญุธูุฉ ููุณุจ ุงูุญุถูุฑ",
        dash_feat2: "ุชูุงุฑูุฑ ุชูุตูููุฉ ุดุงููุฉ",
        dash_feat3: "ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช ูุงูุงุนุชูุงุฏ"
    },
    en: {
        hero_badge: "Official Certified System",
        hero_title: "Smart Attendance System<br><span class='text-highlight'>For Medical Education</span>",
        hero_subtitle: "Integrated Secure Offline-First Solution<br>Designed for Medical Faculties and Training Centers",
        download_on: "Download for",
        nav_lecturer: "For Lecturers",

        // How It Works
        how_it_works_title: "How It Works",
        step_open: "Open App",
        step_connect: "Touch or Select",
        step_done: "Registered",

        // Features
        feat_secure_title: "Secure & Reliable",
        feat_secure_desc: "Uses encrypted technologies to ensure data accuracy",
        feat_offline_title: "Works Offline",
        feat_offline_desc: "Student internet connection not required",
        feat_tech_title: "Modern Tech",
        feat_tech_desc: "Full support for NFC and Bluetooth technologies",
        feat_dashboard_title: "Advanced Dashboard",
        feat_dashboard_desc: "Real-time reports and comprehensive statistics for institutions",

        // Institutions
        inst_badge: "For Institutions",
        inst_title: "Centralized Management",
        inst_desc: "An advanced dashboard that enables you to monitor attendance rates in real-time and export detailed reports for each course, group, lecturer, and learner",
        inst_feat1: "Real-time attendance monitoring",
        inst_feat2: "Exportable detailed reports",
        inst_feat3: "Lecturer permissions management",
        inst_cta: "Contact Us",

        footer_copy: "Med Attendance 2026 All Rights Reserved",
        coming_soon_ios: "Coming Soon on App Store",
        coming_soon_android: "Coming Soon on Google Play",
        support_btn: "Technical Support",
        privacy_policy: "Privacy Policy",
        terms_conditions: "Terms and Conditions",

        // Modal
        modal_title: "Installation on iPhone",
        step1_title: "Step 1: Download TestFlight",
        step1_desc: "Download TestFlight from the Apple Store to install the beta version",
        btn_download_testflight: "Download TestFlight",
        step2_title: "Step 2: Download BardiMad",
        step2_desc: "Join the beta and download the student app",
        btn_download_app: "Download App (Student)",
        btn_next: "Next",
        lang_btn_text: "ุงูุนุฑุจูุฉ",
        download_started: "Download started! Check your Downloads folder ๐ฅ",

        // Navigation & General
        nav_home: "Home",
        nav_kader: "Kader Attendance",
        terms_title: "Terms & Conditions",
        privacy_title: "Privacy Policy",
        page_under_construction: "This page is currently under construction",
        back_home: "Back to Home",
        back_kader: "Back to Kader Attendance",

        // Kader Attendance Page
        kader_badge: "Official Certified System",
        kader_hero_title: "Kader Attendance",
        kader_hero_desc: "An integrated electronic system for attendance management dedicated to the medical education sector. Ensures secure and fast attendance recording using mobile phones only.",
        kader_serving_title: "Serving Sectors",
        kader_target_1: "Medical & Health Sciences Faculties",
        kader_target_2: "Medical Training Centers",
        kader_target_3: "Medical Conferences & Workshops",
        kader_target_4: "CME Institutions",
        mech_title: "How It Works",
        mech_subtitle: "Direct communication between student and lecturer mobiles, no internet required for students.",
        mech_nfc_title: "NFC Technology",
        mech_nfc_desc: "Touch devices together for instant secure recording.",
        mech_bt_title: "Bluetooth Technology",
        mech_bt_desc: "Nearby students appear for the lecturer to select and record.",
        mech_manual_title: "Manual Entry",
        mech_manual_desc: "Lecturer can manually add students if needed.",
        management_badge: "Management & Control",
        lecturer_dash_title: "Accounts & Permissions",
        lecturer_title: "Lecturer Account",
        lecturer_feat1: "Activation upon admin approval",
        lecturer_feat2: "View assigned courses sessions",
        lecturer_feat3: "Record attendance (NFC, BT, Manual)",
        dash_title: "Admin Dashboard",
        dash_feat1: "Real-time attendance monitoring",
        dash_feat2: "Comprehensive detailed reports",
        dash_feat3: "Manage permissions and approvals"
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const langToggle = document.getElementById('lang-toggle');
    const themeToggle = document.getElementById('theme-toggle');
    const currentLangText = document.getElementById('current-lang-text');
    const html = document.documentElement;

    // Modal Elements
    const btnIos = document.getElementById('btn-ios');
    const modal = document.getElementById('ios-modal');
    const modalClose = document.querySelector('.modal-close');
    const btnNext = document.getElementById('btn-next-step');
    const btnAndroid = document.getElementById('btn-android');

    const step1Content = document.getElementById('step-1');
    const step2Content = document.getElementById('step-2');
    const step1Indicator = document.getElementById('step-1-indicator');
    const step2Indicator = document.getElementById('step-2-indicator');

    // State
    let currentLang = 'ar';
    let currentTheme = localStorage.getItem('theme') || 'light';

    // Initialize Theme
    setTheme(currentTheme);

    // 4. Mobile Menu Toggle
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mainNav = document.getElementById('main-nav');

    if (mobileMenuToggle && mainNav) {
        mobileMenuToggle.addEventListener('click', () => {
            mainNav.classList.toggle('active');

            // Toggle icon between menu and X
            const icon = mobileMenuToggle.querySelector('i');
            if (icon) {
                if (mainNav.classList.contains('active')) {
                    icon.setAttribute('data-lucide', 'x');
                } else {
                    icon.setAttribute('data-lucide', 'menu');
                }
                lucide.createIcons();
            }
        });

        // Close menu when clicking a nav link
        mainNav.querySelectorAll('.nav-link, .btn-ghost').forEach(link => {
            link.addEventListener('click', () => {
                mainNav.classList.remove('active');
                const icon = mobileMenuToggle.querySelector('i');
                if (icon) {
                    icon.setAttribute('data-lucide', 'menu');
                    lucide.createIcons();
                }
            });
        });
    }

    // 1. Theme Logic
    themeToggle.addEventListener('click', () => {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        setTheme(currentTheme);
    });

    function setTheme(theme) {
        html.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);

        // Update Icon
        const icon = themeToggle.querySelector('i');
        if (icon) {
            if (theme === 'dark') {
                icon.setAttribute('data-lucide', 'sun');
            } else {
                icon.setAttribute('data-lucide', 'moon');
            }
            lucide.createIcons();
        }
    }

    // 2. Language Switcher
    langToggle.addEventListener('click', () => {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        updateLanguage(currentLang);
    });

    function updateLanguage(lang) {
        // Update HTML dir and lang
        html.lang = lang;
        html.dir = lang === 'ar' ? 'rtl' : 'ltr';

        // Update Text
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang][key]) {
                element.innerHTML = translations[lang][key];
            }
        });

        // Toggle Content Blocks (for pages with large bilingual content)
        const contentEn = document.getElementById('content-en');
        const contentAr = document.getElementById('content-ar');

        if (contentEn && contentAr) {
            if (lang === 'ar') {
                contentEn.style.display = 'none';
                contentAr.style.display = 'block';
            } else {
                contentEn.style.display = 'block';
                contentAr.style.display = 'none';
            }
        }

        // Update Button Text
        currentLangText.textContent = translations[lang].lang_btn_text;

        // Update Lucide Icons (in case they need re-rendering, though mostly unrelated to lang)
        lucide.createIcons();
    }

    // 3. Modal Interactions
    if (btnIos) {
        btnIos.addEventListener('click', () => {
            modal.classList.remove('hidden');
            resetModal();
        });
    }

    if (modalClose) {
        modalClose.addEventListener('click', () => {
            modal.classList.add('hidden');
        });
    }

    // Close on click outside
    if (modal) {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });
    }

    // Step Navigation
    if (btnNext) {
        btnNext.addEventListener('click', () => {
            // Switch to Step 2
            step1Content.classList.add('hidden');
            step2Content.classList.remove('hidden');

            step1Indicator.classList.remove('active');
            step1Indicator.innerHTML = '<i data-lucide="check" style="width:16px"></i>';
            step2Indicator.classList.add('active');

            btnNext.style.display = 'none'; // Hide next button on last step
            lucide.createIcons();
        });
    }

    function resetModal() {
        step1Content.classList.remove('hidden');
        step2Content.classList.add('hidden');

        step1Indicator.classList.add('active');
        step1Indicator.textContent = '1';
        step2Indicator.classList.remove('active');
        step1Indicator.innerHTML = '1';

        btnNext.style.display = 'inline-block';
        lucide.createIcons();
    }

    // Toast Notification Function
    function showToast(message) {
        // Remove existing toast if any
        const existingToast = document.querySelector('.toast-notification');
        if (existingToast) {
            existingToast.remove();
        }

        // Create toast element
        const toast = document.createElement('div');
        toast.className = 'toast-notification';
        toast.innerHTML = `
            <i data-lucide="download" class="toast-icon"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(toast);
        lucide.createIcons();

        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);

        // Hide and remove after 4 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 4000);
    }

    // Android Download Button - Show Toast
    if (btnAndroid) {
        btnAndroid.addEventListener('click', () => {
            const message = translations[currentLang].download_started;
            showToast(message);
        });
    }
});
