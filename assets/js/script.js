const translations = {
    ar: {
        hero_badge: "Ù†Ø¸Ø§Ù… Ø±Ø³Ù…ÙŠ Ù…Ø¹ØªÙ…Ø¯",
        hero_title: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠ<br><span class='text-highlight'>Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠ</span>",
        hero_subtitle: "Ø­Ù„ ØªÙ‚Ù†ÙŠ Ù…ØªÙƒØ§Ù…Ù„ ÙˆØ¢Ù…Ù† ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª<br>Ù…ØµÙ…Ù… Ø®ØµÙŠØµØ§Ù‹ Ù„Ø®Ø¯Ù…Ø© ÙƒÙ„ÙŠØ§Øª Ø§Ù„Ø·Ø¨ ÙˆÙ…Ø±Ø§ÙƒØ² Ø§Ù„ØªØ¯Ø±ÙŠØ¨",
        download_on: "ØªØ­Ù…ÙŠÙ„ Ù„Ø£Ø¬Ù‡Ø²Ø©",
        nav_lecturer: "Ù„Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ†",

        // How It Works
        how_it_works_title: "ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…",
        step_open: "ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚",
        step_connect: "ØªÙ„Ø§Ù…Ø³ Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø±",
        step_done: "ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„",

        // Features
        feat_secure_title: "Ø¢Ù…Ù† ÙˆÙ…ÙˆØ«ÙˆÙ‚",
        feat_secure_desc: "ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªÙ‚Ù†ÙŠØ§Øª Ù…Ø´ÙØ±Ø© Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
        feat_offline_title: "ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª",
        feat_offline_desc: "Ù„Ø§ ÙŠØ´ØªØ±Ø· Ø§ØªØµØ§Ù„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±",
        feat_tech_title: "ØªÙ‚Ù†ÙŠØ§Øª Ø­Ø¯ÙŠØ«Ø©",
        feat_tech_desc: "Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„ØªÙ‚Ù†ÙŠØ§Øª NFC Ùˆ Bluetooth",
        feat_dashboard_title: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…Ø©",
        feat_dashboard_desc: "ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ø­Ø¸ÙŠØ© ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª",

        // Institutions
        inst_badge: "Ù„Ù„Ù…Ø¤Ø³Ø³Ø§Øª",
        inst_title: "Ø¥Ø¯Ø§Ø±Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ù…Ø¤Ø³Ø³ØªÙƒ",
        inst_desc: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…Ø© ØªÙ…ÙƒÙ†Ùƒ Ù…Ù† Ù…ØªØ§Ø¨Ø¹Ø© Ù†Ø³Ø¨ Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ø­Ø¸ÙŠØ§Ù‹ ÙˆØªØµØ¯ÙŠØ± ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© Ù„ÙƒÙ„ ÙƒÙˆØ±Ø³ ÙˆÙ…Ø¬Ù…ÙˆØ¹Ø© ÙˆÙ…Ø­Ø§Ø¶Ø± ÙˆÙ…ØªØ¹Ù„Ù…",
        inst_feat1: "Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ø­Ø¸ÙŠØ© Ù„Ù„Ø­Ø¶ÙˆØ±",
        inst_feat2: "ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØµØ¯ÙŠØ±",
        inst_feat3: "Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ†",
        inst_cta: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",

        footer_copy: "Med Attendance 2026 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©",
        coming_soon_ios: "Ù‚Ø±ÙŠØ¨Ø§Ù‹ ÙÙŠ App Store",
        coming_soon_android: "Ù‚Ø±ÙŠØ¨Ø§Ù‹ ÙÙŠ Google Play",
        support_btn: "Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ",
        privacy_policy: "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©",
        terms_conditions: "Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…",

        // Modal
        modal_title: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù„Ù‰ iPhone",
        step1_title: "Ø®Ø·ÙˆØ© 1: ØªØ­Ù…ÙŠÙ„ TestFlight",
        step1_desc: "ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ TestFlight Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ù…ØªØ¬Ø± Ø£Ø¨Ù„ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ«Ø¨ÙŠØª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©",
        btn_download_testflight: "ØªØ­Ù…ÙŠÙ„ TestFlight",
        step2_title: "Ø®Ø·ÙˆØ© 2: ØªØ­Ù…ÙŠÙ„ BardiMad",
        step2_desc: "Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙˆØªØ­Ù…ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø·Ø§Ù„Ø¨",
        btn_download_app: "ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø·Ù„Ø§Ø¨)",
        btn_next: "Ø§Ù„ØªØ§Ù„ÙŠ",
        lang_btn_text: "English",
        download_started: "ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ†Ø²ÙŠÙ„! ØªÙÙ‚Ø¯ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØªÙ†Ø²ÙŠÙ„Ø§Øª ğŸ“¥",

        // Navigation & General
        nav_home: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        nav_supervisor: "Attendance Supervisor",
        terms_title: "Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…",
        privacy_title: "Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©",
        page_under_construction: "Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø§Ù„ÙŠØ§Ù‹",
        back_home: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        back_supervisor: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù€ Attendance Supervisor",

        // Attendance Supervisor Page
        supervisor_badge: "Ù†Ø¸Ø§Ù… Ø±Ø³Ù…ÙŠ Ù…Ø¹ØªÙ…Ø¯",
        supervisor_hero_title: "Attendance Supervisor",
        supervisor_hero_desc: "Ù†Ø¸Ø§Ù… Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨ Ù…Ø®ØµØµ Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠ. ÙŠØ¶Ù…Ù† Ù„Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¢Ù…Ù†Ø© ÙˆØ³Ø±ÙŠØ¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© ÙÙ‚Ø·.",
        supervisor_serving_title: "ÙŠØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù…",
        supervisor_target_1: "ÙƒÙ„ÙŠØ§Øª Ø§Ù„Ø·Ø¨ ÙˆØ§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ØµØ­ÙŠØ©",
        supervisor_target_2: "Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø·Ø¨ÙŠ",
        supervisor_target_3: "Ø§Ù„Ù…Ø¤ØªÙ…Ø±Ø§Øª ÙˆÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„",
        supervisor_target_4: "Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ù…Ø³ØªÙ…Ø±",
        mech_title: "Ø¢Ù„ÙŠØ© Ø§Ù„Ø¹Ù…Ù„",
        mech_subtitle: "ØªÙˆØ§ØµÙ„ Ù…Ø¨Ø§Ø´Ø± Ø¨ÙŠÙ† Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ù…ØªØ¹Ù„Ù… ÙˆÙ…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±ØŒ ÙˆÙ„Ø§ ÙŠØ´ØªØ±Ø· ØªÙˆØ§Ø¬Ø¯ Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ©.",
        mech_nfc_title: "ØªÙ‚Ù†ÙŠØ© NFC",
        mech_nfc_desc: "Ù…Ù„Ø§Ù…Ø³Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ÙŠÙ† Ù„Ø¨Ø¹Ø¶Ù‡Ù…Ø§ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙˆØ±Ø§Ù‹ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†.",
        mech_bt_title: "ØªÙ‚Ù†ÙŠØ© Bluetooth",
        mech_bt_desc: "ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…ØªØ¹Ù„Ù…ÙˆÙ† Ø§Ù„Ù‚Ø±ÙŠØ¨ÙˆÙ† Ù„Ø¯Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¶Ø± Ù„ÙŠØ®ØªØ§Ø± Ù…Ù†Ù‡Ù… ÙˆÙŠØ³Ø¬Ù„ Ø­Ø¶ÙˆØ±Ù‡Ù….",
        mech_manual_title: "Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©",
        mech_manual_desc: "ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø­Ø§Ø¶Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ¹Ù„Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ØªÙˆÙØ± Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ø£Ø®Ø±Ù‰.",
        management_badge: "Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„ØªØ­ÙƒÙ…",
        lecturer_dash_title: "Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª",
        lecturer_title: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±",
        lecturer_feat1: "ØªÙØ¹ÙŠÙ„ Ø¨Ø¹Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
        lecturer_feat2: "Ø±Ø¤ÙŠØ© Ø§Ù„Ø³ÙŠØ´Ù†Ø§Øª ÙˆØ§Ù„ÙØ±Ù‚",
        lecturer_feat3: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± (NFC, BT, ÙŠØ¯ÙˆÙŠ)",
        dash_title: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©",
        dash_feat1: "Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ø­Ø¸ÙŠØ© Ù„Ù†Ø³Ø¨ Ø§Ù„Ø­Ø¶ÙˆØ±",
        dash_feat2: "ØªÙ‚Ø§Ø±ÙŠØ± ØªÙØµÙŠÙ„ÙŠØ© Ø´Ø§Ù…Ù„Ø©",
        dash_feat3: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯"
    },
    en: {
        hero_badge: "Official Certified System",
        hero_title: "Smart Attendance System<br><span class='text-highlight'>For Medical Education</span>",
        hero_subtitle: "Integrated Secure Offline-First Solution<br>Designed for Medical Faculties and Training Centers",
        download_on: "Download for",
        nav_lecturer: "For Lecturers",

        // How It Works
        how_it_works_title: "How It Works",
        step_open: "Open App",
        step_connect: "Touch or Select",
        step_done: "Registered",

        // Features
        feat_secure_title: "Secure & Reliable",
        feat_secure_desc: "Uses encrypted technologies to ensure data accuracy",
        feat_offline_title: "Works Offline",
        feat_offline_desc: "Student internet connection not required",
        feat_tech_title: "Modern Tech",
        feat_tech_desc: "Full support for NFC and Bluetooth technologies",
        feat_dashboard_title: "Advanced Dashboard",
        feat_dashboard_desc: "Real-time reports and comprehensive statistics for institutions",

        // Institutions
        inst_badge: "For Institutions",
        inst_title: "Centralized Management",
        inst_desc: "An advanced dashboard that enables you to monitor attendance rates in real-time and export detailed reports for each course, group, lecturer, and learner",
        inst_feat1: "Real-time attendance monitoring",
        inst_feat2: "Exportable detailed reports",
        inst_feat3: "Lecturer permissions management",
        inst_cta: "Contact Us",

        footer_copy: "Med Attendance 2026 All Rights Reserved",
        coming_soon_ios: "Coming Soon on App Store",
        coming_soon_android: "Coming Soon on Google Play",
        support_btn: "Technical Support",
        privacy_policy: "Privacy Policy",
        terms_conditions: "Terms and Conditions",

        // Modal
        modal_title: "Installation on iPhone",
        step1_title: "Step 1: Download TestFlight",
        step1_desc: "Download TestFlight from the Apple Store to install the beta version",
        btn_download_testflight: "Download TestFlight",
        step2_title: "Step 2: Download BardiMad",
        step2_desc: "Join the beta and download the student app",
        btn_download_app: "Download App (Student)",
        btn_next: "Next",
        lang_btn_text: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
        download_started: "Download started! Check your Downloads folder ğŸ“¥",

        // Navigation & General
        nav_home: "Home",
        nav_supervisor: "Attendance Supervisor",
        terms_title: "Terms & Conditions",
        privacy_title: "Privacy Policy",
        page_under_construction: "This page is currently under construction",
        back_home: "Back to Home",
        back_supervisor: "Back to Attendance Supervisor",

        // Attendance Supervisor Page
        supervisor_badge: "Official Certified System",
        supervisor_hero_title: "Attendance Supervisor",
        supervisor_hero_desc: "An integrated electronic system for attendance management dedicated to the medical education sector. Ensures secure and fast attendance recording using mobile phones only.",
        supervisor_serving_title: "Serving Sectors",
        supervisor_target_1: "Medical & Health Sciences Faculties",
        supervisor_target_2: "Medical Training Centers",
        supervisor_target_3: "Medical Conferences & Workshops",
        supervisor_target_4: "CME Institutions",
        mech_title: "How It Works",
        mech_subtitle: "Direct communication between student and lecturer mobiles, no internet required for students.",
        mech_nfc_title: "NFC Technology",
        mech_nfc_desc: "Touch devices together for instant secure recording.",
        mech_bt_title: "Bluetooth Technology",
        mech_bt_desc: "Nearby students appear for the lecturer to select and record.",
        mech_manual_title: "Manual Entry",
        mech_manual_desc: "Lecturer can manually add students if needed.",
        management_badge: "Management & Control",
        lecturer_dash_title: "Accounts & Permissions",
        lecturer_title: "Lecturer Account",
        lecturer_feat1: "Activation upon admin approval",
        lecturer_feat2: "View assigned courses sessions",
        lecturer_feat3: "Record attendance (NFC, BT, Manual)",
        dash_title: "Admin Dashboard",
        dash_feat1: "Real-time attendance monitoring",
        dash_feat2: "Comprehensive detailed reports",
        dash_feat3: "Manage permissions and approvals"
    }
};

const CONSTANTS = {
    STORAGE: {
        LANG: 'lang',
        THEME: 'theme'
    },
    THEME: {
        LIGHT: 'light',
        DARK: 'dark'
    },
    LANG: {
        AR: 'ar',
        EN: 'en'
    },
    CLASSES: {
        ACTIVE: 'active',
        HIDDEN: 'hidden'
    }
};

document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const ui = {
        langToggle: document.getElementById('lang-toggle'),
        themeToggle: document.getElementById('theme-toggle'),
        currentLangText: document.getElementById('current-lang-text'),
        html: document.documentElement,

        // Modal Elements
        btnIos: document.getElementById('btn-ios'),
        modal: document.getElementById('ios-modal'),
        modalClose: document.querySelector('.modal-close'),
        btnNext: document.getElementById('btn-next-step'),
        btnAndroid: document.getElementById('btn-android'),

        step1Content: document.getElementById('step-1'),
        step2Content: document.getElementById('step-2'),
        step1Indicator: document.getElementById('step-1-indicator'),
        step2Indicator: document.getElementById('step-2-indicator'),

        // Navigation
        mobileMenuToggle: document.getElementById('mobile-menu-toggle'),
        mainNav: document.getElementById('main-nav'),

        // Content Blocks
        contentEn: document.getElementById('content-en'),
        contentAr: document.getElementById('content-ar')
    };

    // State
    let currentLang = localStorage.getItem(CONSTANTS.STORAGE.LANG) || CONSTANTS.LANG.EN;
    let currentTheme = localStorage.getItem(CONSTANTS.STORAGE.THEME) || CONSTANTS.THEME.LIGHT;

    // Initialize Theme
    setTheme(currentTheme);

    // Initialize Language
    updateLanguage(currentLang);

    // --- Core Functions ---

    function setTheme(theme) {
        ui.html.setAttribute('data-theme', theme);
        localStorage.setItem(CONSTANTS.STORAGE.THEME, theme);

        const icon = ui.themeToggle?.querySelector('i');
        if (icon) {
            icon.setAttribute('data-lucide', theme === CONSTANTS.THEME.DARK ? 'sun' : 'moon');
            lucide.createIcons();
        }
    }

    function updateLanguage(lang) {
        // Persist Language
        localStorage.setItem(CONSTANTS.STORAGE.LANG, lang);

        // Update HTML dir and lang
        ui.html.lang = lang;
        ui.html.dir = lang === CONSTANTS.LANG.AR ? 'rtl' : 'ltr';

        // Update Text
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[lang]?.[key]) {
                element.innerHTML = translations[lang][key];
            }
        });

        // Toggle Content Blocks (for pages with large bilingual content)
        if (ui.contentEn && ui.contentAr) {
            const isAr = lang === CONSTANTS.LANG.AR;
            ui.contentEn.style.display = isAr ? 'none' : 'block';
            ui.contentAr.style.display = isAr ? 'block' : 'none';
        }

        // Update Button Text
        if (ui.currentLangText) {
            ui.currentLangText.textContent = translations[lang]?.lang_btn_text;
        }

        // Update Lucide Icons
        lucide.createIcons();
    }

    function resetModal() {
        ui.step1Content?.classList.remove(CONSTANTS.CLASSES.HIDDEN);
        ui.step2Content?.classList.add(CONSTANTS.CLASSES.HIDDEN);

        ui.step1Indicator?.classList.add(CONSTANTS.CLASSES.ACTIVE);
        if (ui.step1Indicator) ui.step1Indicator.textContent = '1';

        ui.step2Indicator?.classList.remove(CONSTANTS.CLASSES.ACTIVE);
        if (ui.step2Indicator) ui.step2Indicator.innerHTML = '2';

        if (ui.btnNext) ui.btnNext.style.display = 'inline-block';
        lucide.createIcons();
    }

    function showToast(message) {
        // Remove existing toast if any
        const existingToast = document.querySelector('.toast-notification');
        existingToast?.remove();

        // Create toast element
        const toast = document.createElement('div');
        toast.className = 'toast-notification';
        toast.innerHTML = `
            <i data-lucide="download" class="toast-icon"></i>
            <span>${message}</span>
        `;
        document.body.appendChild(toast);
        lucide.createIcons();

        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);

        // Hide and remove after 4 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 4000);
    }

    // --- Event Listeners ---

    // Mobile Menu Toggle
    if (ui.mobileMenuToggle && ui.mainNav) {
        ui.mobileMenuToggle.addEventListener('click', () => {
            ui.mainNav.classList.toggle(CONSTANTS.CLASSES.ACTIVE);

            // Toggle icon between menu and X
            const icon = ui.mobileMenuToggle.querySelector('i');
            const isActive = ui.mainNav.classList.contains(CONSTANTS.CLASSES.ACTIVE);
            icon?.setAttribute('data-lucide', isActive ? 'x' : 'menu');
            lucide.createIcons();
        });

        // Close menu when clicking a nav link
        ui.mainNav.querySelectorAll('.nav-link, .btn-ghost').forEach(link => {
            link.addEventListener('click', () => {
                ui.mainNav.classList.remove(CONSTANTS.CLASSES.ACTIVE);
                const icon = ui.mobileMenuToggle.querySelector('i');
                icon?.setAttribute('data-lucide', 'menu');
                lucide.createIcons();
            });
        });
    }

    // Theme Logic
    ui.themeToggle?.addEventListener('click', () => {
        currentTheme = currentTheme === CONSTANTS.THEME.LIGHT ? CONSTANTS.THEME.DARK : CONSTANTS.THEME.LIGHT;
        setTheme(currentTheme);
    });

    // Language Switcher
    ui.langToggle?.addEventListener('click', () => {
        currentLang = currentLang === CONSTANTS.LANG.AR ? CONSTANTS.LANG.EN : CONSTANTS.LANG.AR;
        updateLanguage(currentLang);
    });

    // Modal Interactions
    ui.btnIos?.addEventListener('click', () => {
        ui.modal?.classList.remove(CONSTANTS.CLASSES.HIDDEN);
        resetModal();
    });

    ui.modalClose?.addEventListener('click', () => {
        ui.modal?.classList.add(CONSTANTS.CLASSES.HIDDEN);
    });

    // Close on click outside
    ui.modal?.addEventListener('click', (e) => {
        if (e.target === ui.modal) {
            ui.modal.classList.add(CONSTANTS.CLASSES.HIDDEN);
        }
    });

    // Step Navigation
    ui.btnNext?.addEventListener('click', () => {
        // Switch to Step 2
        ui.step1Content?.classList.add(CONSTANTS.CLASSES.HIDDEN);
        ui.step2Content?.classList.remove(CONSTANTS.CLASSES.HIDDEN);

        ui.step1Indicator?.classList.remove(CONSTANTS.CLASSES.ACTIVE);
        if (ui.step1Indicator) ui.step1Indicator.innerHTML = '<i data-lucide="check" style="width:16px"></i>';

        ui.step2Indicator?.classList.add(CONSTANTS.CLASSES.ACTIVE);

        ui.btnNext.style.display = 'none'; // Hide next button on last step
        lucide.createIcons();
    });

    // Android Download Button - Show Toast
    ui.btnAndroid?.addEventListener('click', () => {
        const message = translations[currentLang]?.download_started;
        showToast(message);
    });

});
